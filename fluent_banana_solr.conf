<source>
  @type tail
  log_level error
  format grok
  <grok>
    pattern %{COMBINEDAPACHELOG:message}
    time_format "%d/%b/%Y:%H:%M:%S %z"
  </grok>
  path /tmp/access.log
  pos_file /tmp/access.log.pos
  tag tail.logs
</source>

<filter tail.logs>
  @type geoip
  log_level error
  enable_auto_download true
  md5_url http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.md5
  download_url http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz
  md5_path ./geoip/database/GeoLite2-City.md5
  database_path ./geoip/database/GeoLite2-City.mmdb
  lookup_field clientip
  output_field geoip
  field_delimiter _
  flatten true
  locale en
  continent true
  country true
  city true
  location true
  postal true
  registered_country true
  represented_country true
  subdivisions true
  traits true
  connection_type true
</filter>

<filter tail.logs>
  @type record_transformer
  log_level error
  enable_ruby
  <record>
    geoip_localtion_latitude_longitude ${geoip_location_latitude.nil? || geoip_location_longitude.nil? ? nil : geoip_location_latitude.to_s + ',' + geoip_location_longitude.to_s}
  </record>
</filter>

<match tail.logs>
  @type solr
  log_level error
  #zk_host localhost:2181/solr
  #collection httpd_logs
  url http://localhost:8983/solr/httpd_logs
  ignore_undefined_fields false
  flush_size 100
  buffer_type memory
  buffer_queue_limit 64m
  buffer_chunk_limit 8m
  flush_interval 10s
</match>

#<match tail.logs>
#  type stdout
#</match>
